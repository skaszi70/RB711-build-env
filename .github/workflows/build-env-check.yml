name: OpenWrt Debug Build

on: [workflow_dispatch]

jobs:
  debug_build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up build environment
        run: |
          sudo apt update && sudo apt install -y build-essential libncurses5-dev zlib1g-dev gawk git

      - name: Clone OpenWrt repository
        run: |
          git clone https://github.com/openwrt/openwrt.git
          cd openwrt
          ./scripts/feeds update -a
          ./scripts/feeds install -a

      - name: Run menuconfig
        run: |
          cd openwrt
          make menuconfig || echo "menuconfig failed!"

      - name: Start build (without optimization)
        run: |
          cd openwrt
          make -j$(nproc) || echo "Build failed!"

      - name: Upload logs
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: build-logs
          path: openwrt/logs

